name: TypeScript Client CI

on:
  push:
    branches: [main]
  pull_request:

jobs:
  build-and-test:
    uses: matt-riley/matt-riley-ci/.github/workflows/node-ci.yml@338b176231bf389e78268ef2f38c016bb1ff832b
    with:
      node-version: "24"
      package-manager: npm
      working-directory: clients/typescript
      cache-dependency-path: clients/typescript/package-lock.json
      run-lint: false
      run-test: true
      run-build: true

  verify-proto-sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v6

      - name: Verify proto sync
        run: |
          # The TS client proto is a copy of the canonical api/proto/v1/flag_service.proto.
          # This check ensures they stay in sync.
          diff api/proto/v1/flag_service.proto clients/typescript/proto/flag_service.proto
